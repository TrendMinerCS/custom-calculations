<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Custom Calculation Runner</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-gray-50 to-gray-100 font-sans antialiased">
  <!-- Sidebar + Navbar layout -->
  <div class="flex flex-col h-screen">
    <!-- Header with logo -->
    <header class="bg-blue-600 p-4 flex items-center">
      <img src="{{ url_for('static', filename='trendminer_logo.svg') }}"
           alt="TrendMiner Logo" class="h-12 mr-4" />
      <h1 class="text-white text-3xl font-bold">Custom Calculation Runner</h1>
    </header>
    <!-- Main content -->
    <div class="flex-1 flex flex-col min-h-0">

      <!-- Content -->
      <div class="flex-1 flex flex-col min-h-0">
        <!-- Form card -->
        <div class="bg-white/80 backdrop-blur-lg rounded-xl shadow-lg p-8 mb-6 border-l-4 border-blue-600">
          <form method="POST" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- Script selector -->
            <div>
              <label class="block text-gray-700 mb-1">Python Script</label>
              <select name="script" class="w-full border-gray-300 rounded p-2 focus:ring-2 focus:ring-blue-400 focus:outline-none">
                {% for s in scripts %}
                <option value="{{ s }}" {% if s == script %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
              </select>
            </div>
            <!-- Start -->
            <div>
              <label class="block text-gray-700 mb-1">Start</label>
              <input type="datetime-local" name="start" value="{{ start }}"
                class="w-full border-gray-300 rounded p-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" required />
            </div>
            <!-- End -->
            <div>
              <label class="block text-gray-700 mb-1">End</label>
              <input type="datetime-local" name="end" value="{{ end }}"
                class="w-full border-gray-300 rounded p-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" required />
            </div>
            <!-- Mode -->
            <div>
              <label class="block text-gray-700 mb-1">Mode</label>
              <select name="mode" class="w-full border-gray-300 rounded p-2 focus:ring-2 focus:ring-blue-400 focus:outline-none">
                <option value="analog" {% if mode=='analog' %}selected{% endif %}>Analog</option>
                <option value="block" {% if mode=='block' %}selected{% endif %}>Block</option>
              </select>
            </div>
            <!-- Submit button -->
            <div class="md:col-span-4 text-right">
              <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-full shadow-md hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 transition">
                Run & Plot
              </button>
            </div>
          </form>
        </div>

        <!-- Chart container -->
        <div class="bg-white/80 backdrop-blur-lg rounded-xl shadow-lg p-6 flex-1 overflow-auto min-h-0 border border-gray-200">
          {% if timestamps %}
          <canvas id="chart" class="w-full h-full"></canvas>
          {% else %}
          <p class="text-gray-500">No data to display. Run a calculation above.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    (() => {
      const labels = {{ timestamps|tojson }};
      const data   = {{ values|tojson }};
      if (labels.length) {
        new Chart(document.getElementById('chart'), {
          type: 'line',
          data: { labels, datasets: [{
            label: 'Calculated Tag',
            data,
            borderColor: '#1A9FDC', // TrendMiner blue accent
            backgroundColor: 'rgba(26, 159, 220, 0.1)',
            pointRadius: 0,
            stepped: {{ 'true' if mode == 'block' else 'false' }},
            tension: 0.3
          }]},
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { grid: { color: '#eee' } },
              y: { grid: { color: '#eee' } }
            },
            interaction: { mode: 'nearest', axis: 'x', intersect: false }
          }
        });
      }
    })();
  </script>
</body>
</html>